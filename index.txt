<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¯¶ç®±è§£è¬æ‹¼åœ–</title>
    <style>
        /* --- åŸºç¤è¨­å®š --- */
        body {
            font-family: "Microsoft JhengHei", sans-serif;
            background-color: #2c3e50;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }

        h2 { margin-bottom: 10px; text-align: center; }
        p { text-align: center; margin-bottom: 20px; color: #ecf0f1; }

        /* --- ç™»å…¥å€å¡Š --- */
        #login-section {
            background: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            width: 100%;
            max-width: 350px;
        }

        input[type="text"] {
            padding: 10px;
            font-size: 18px;
            width: 80%;
            border-radius: 5px;
            border: none;
            margin-bottom: 15px;
            text-align: center;
        }

        button {
            padding: 10px 25px;
            font-size: 18px;
            background-color: #e67e22;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: 0.3s;
        }

        button:active { transform: scale(0.95); }

        /* --- éŠæˆ²å€å¡Š (é è¨­éš±è—) --- */
        #game-section { display: none; width: 100%; max-width: 400px; flex-direction: column; align-items: center; }

        /* --- æ‹¼åœ–å®¹å™¨ --- */
        #puzzle-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr); /* 3åˆ— */
            grid-template-rows: repeat(3, 1fr);    /* 3è¡Œ */
            gap: 2px;
            width: 100%;
            aspect-ratio: 1 / 1; /* ä¿æŒæ­£æ–¹å½¢ */
            background-color: #34495e;
            border: 5px solid #fff;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            position: relative;
        }

        /* --- æ‹¼åœ–å¡Š --- */
        .puzzle-piece {
            background-size: 300% 300%; /* å› ç‚ºæ˜¯3x3ï¼Œæ‰€ä»¥æ”¾å¤§3å€ */
            cursor: pointer;
            transition: transform 0.2s, border 0.2s;
            position: relative;
        }

        /* é¸ä¸­æ™‚çš„ç‰¹æ•ˆ */
        .selected {
            border: 2px solid #e74c3c;
            z-index: 10;
            transform: scale(0.95);
            box-shadow: 0 0 10px #e74c3c;
        }

        /* --- éé—œè¨Šæ¯ --- */
        #success-message {
            display: none;
            margin-top: 20px;
            padding: 15px;
            background-color: #27ae60;
            border-radius: 10px;
            animation: popIn 0.5s ease;
        }

        @keyframes popIn {
            0% { transform: scale(0); }
            80% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        /* éŒ¯èª¤è¨Šæ¯ */
        #error-msg { color: #e74c3c; margin-top: 10px; display: none; font-weight: bold; }

    </style>
</head>
<body>

    <div id="login-section">
        <h2>å¯¶ç®±æç¤º</h2>
        <p>è¼¸å…¥å¯†ç¢¼ä»¥é–‹å•Ÿå¯¶ç®±æç¤ºå°éŠæˆ²</p>
        <input type="text" id="password-input" placeholder="è¼¸å…¥å››ä½æ•¸å­—" inputmode="numeric">
        <br>
        <button onclick="checkPassword()">é–‹å•Ÿå¯¶ç®±</button>
        <div id="error-msg">å¯†ç¢¼éŒ¯èª¤ï¼Œè«‹å†è©¦ä¸€æ¬¡</div>
    </div>

    <div id="game-section">
        <h2 id="level-title">æ‹¼åœ–æŒ‘æˆ°</h2>
        <p>é»æ“Šå…©å¡Šæ‹¼åœ–å¯äº¤æ›ä½ç½®</p>
        
        <div id="puzzle-container">
            </div>

        <div id="success-message">
            <h3>ğŸ‰ æ­å–œé€šé—œï¼ ğŸ‰</h3>
            <p>ä½ å·²æˆåŠŸé‚„åŸåœ–ç‰‡ï¼</p>
            <button onclick="location.reload()">è¿”å›é¦–é </button>
        </div>
    </div>

    <script>
        // ==========================================
        // â˜… è¨­å®šå€ï¼šè«‹åœ¨æ­¤è™•æ›´æ›ä½ çš„åœ–ç‰‡é€£çµ â˜…
        // ==========================================
        const levels = {
            "2026": {
                title: "å¯¶ç®±æç¤º(ä¸€)",
                // å»ºè­°ä½¿ç”¨æ­£æ–¹å½¢åœ–ç‰‡ (1:1)
                imageUrl: "https://drive.google.com/file/d/1wXoGX2gKv9flVPOvkSLjNaFyqAwT_GhW/view?usp=sharing" 
            },
            "2552": {
                title: "å¯¶ç®±æç¤º(äºŒ)",
                // é€™æ˜¯ç¬¬äºŒå¼µåœ–
                imageUrl: "https://images.unsplash.com/photo-1618005182384-a83a8bd57fbe?q=80&w=800&auto=format&fit=crop" 
            }
        };
        // ==========================================

        let currentImage = "";
        let pieces = []; // å„²å­˜ç›®å‰çš„æ’åˆ—é †åº [0, 1, 2...]
        let selectedPieceIndex = null; // ç›®å‰é¸ä¸­çš„æ‹¼åœ–ç´¢å¼•

        // 1. æª¢æŸ¥å¯†ç¢¼
        function checkPassword() {
            const input = document.getElementById('password-input').value.trim();
            const errorMsg = document.getElementById('error-msg');
            
            if (levels[input]) {
                // å¯†ç¢¼æ­£ç¢º
                document.getElementById('login-section').style.display = 'none';
                document.getElementById('game-section').style.display = 'flex';
                document.getElementById('level-title').innerText = levels[input].title;
                
                currentImage = levels[input].imageUrl;
                startGame();
            } else {
                // å¯†ç¢¼éŒ¯èª¤
                errorMsg.style.display = 'block';
                document.getElementById('password-input').value = '';
            }
        }

        // 2. é–‹å§‹éŠæˆ²åˆå§‹åŒ–
        function startGame() {
            const container = document.getElementById('puzzle-container');
            container.innerHTML = '';
            pieces = [0, 1, 2, 3, 4, 5, 6, 7, 8];
            
            // æ‰“äº‚é †åº (ç¢ºä¿ä¸æœƒå‰›å¥½æ˜¯å®Œæˆç‹€æ…‹)
            do {
                pieces.sort(() => Math.random() - 0.5);
            } while (checkIfWin(true)); // å¦‚æœå‰›å¥½æ’å¥½ï¼Œå°±é‡æ´—

            // å»ºç«‹ 9 å€‹ div
            pieces.forEach((imgIndex, gridIndex) => {
                const piece = document.createElement('div');
                piece.classList.add('puzzle-piece');
                piece.dataset.index = gridIndex; // é€™æ˜¯å®ƒç›®å‰åœ¨æ ¼å­è£¡çš„ä½ç½® (0-8)
                
                // è¨­å®šèƒŒæ™¯åœ–
                piece.style.backgroundImage = `url('${currentImage}')`;
                
                // è¨ˆç®—èƒŒæ™¯ä½ç½® (é€™æ˜¯é—œéµï¼šæ ¹æ“š imgIndex æ±ºå®šé¡¯ç¤ºåœ–ç‰‡çš„å“ªä¸€å¡Š)
                // 0 1 2
                // 3 4 5
                // 6 7 8
                const row = Math.floor(imgIndex / 3);
                const col = imgIndex % 3;
                piece.style.backgroundPosition = `${col * 50}% ${row * 50}%`; 
                // 50% æ˜¯å› ç‚ºèƒŒæ™¯è¨­ç‚º 300%ï¼Œä½ç½®ä½ç§»åˆ†åˆ¥æ˜¯ 0%, 50%, 100%

                // é»æ“Šäº‹ä»¶
                piece.onclick = () => onPieceClick(gridIndex);
                container.appendChild(piece);
            });
        }

        // 3. é»æ“Šè™•ç† (äº¤æ›é‚è¼¯)
        function onPieceClick(index) {
            // å¦‚æœå·²ç¶“éé—œï¼Œç¦æ­¢æ“ä½œ
            if(document.getElementById('success-message').style.display === 'block') return;

            const domPieces = document.querySelectorAll('.puzzle-piece');

            if (selectedPieceIndex === null) {
                // ç¬¬ä¸€æ¬¡é»æ“Šï¼šé¸å–
                selectedPieceIndex = index;
                domPieces[index].classList.add('selected');
            } else {
                // ç¬¬äºŒæ¬¡é»æ“Šï¼šäº¤æ›
                if (selectedPieceIndex !== index) {
                    swapPieces(selectedPieceIndex, index);
                }
                // å–æ¶ˆé¸å–æ¨£å¼
                domPieces[selectedPieceIndex].classList.remove('selected');
                selectedPieceIndex = null;
            }
        }

        // 4. äº¤æ›è³‡æ–™èˆ‡ç•«é¢
        function swapPieces(idx1, idx2) {
            // äº¤æ›é™£åˆ—è³‡æ–™
            [pieces[idx1], pieces[idx2]] = [pieces[idx2], pieces[idx1]];
            
            // é‡æ–°æ¸²æŸ“ç•«é¢ (ç°¡å–®æš´åŠ›æ³•ï¼šé‡ç•« DOM)
            // ç‚ºäº†ä¿ç•™å‹•ç•«æ•ˆæœï¼Œé€™è£¡æˆ‘å€‘äº¤æ› DOM çš„ backgroundPosition
            const domPieces = document.querySelectorAll('.puzzle-piece');
            const bg1 = domPieces[idx1].style.backgroundPosition;
            const bg2 = domPieces[idx2].style.backgroundPosition;
            
            domPieces[idx1].style.backgroundPosition = bg2;
            domPieces[idx2].style.backgroundPosition = bg1;

            // æª¢æŸ¥æ˜¯å¦éé—œ
            checkIfWin();
        }

        // 5. æª¢æŸ¥å‹åˆ©
        function checkIfWin(silent = false) {
            // æª¢æŸ¥ pieces é™£åˆ—æ˜¯å¦ç­‰æ–¼ [0, 1, 2, 3, 4, 5, 6, 7, 8]
            // æ³¨æ„ï¼šå› ç‚ºä¸Šé¢ swapPieces å¯¦éš›ä¸Šæ²’æœ‰é‡ç¹ª DOM é †åºï¼Œè€Œæ˜¯äº¤æ›æ¨£å¼ï¼Œ
            // é€™è£¡æˆ‘å€‘éœ€è¦æª¢æŸ¥æ¯å€‹æ ¼å­çš„ backgroundPosition æ˜¯å¦å°æ‡‰æ­£ç¢ºã€‚
            // ç‚ºäº†ç°¡åŒ–é‚è¼¯ï¼Œæˆ‘å€‘æ”¹ç‚ºæª¢æŸ¥è³‡æ–™å±¤çš„ pieces
            
            // ä¿®æ­£ï¼šä¸Šé¢çš„ swapPieces äº¤æ›äº† pieces é™£åˆ—ï¼Œæ‰€ä»¥ç›´æ¥æ¯”å° pieces
            for (let i = 0; i < 9; i++) {
                if (pieces[i] !== i) return false;
            }

            if (!silent) {
                setTimeout(() => {
                    document.getElementById('success-message').style.display = 'block';
                }, 300);
            }
            return true;
        }
    </script>
</body>
</html>